---
title: 'Tipología y ciclo de vida de los datos: Práctica2'
author: "Antonio Guzmán Martín"
date: "Diciembre 2017"
output:
  pdf_document:
    toc: yes
    toc_depth: '2'
  html_document:
    highlight: default
    number_sections: yes
    theme: cosmo
    toc: yes
    toc_depth: 2
---

```{r}
library(readr)
wine_red <- read.csv("~/Desktop/Tipología\ y\ ciclo\ de\ vida\ de\ los\ datos/practica2/wine/winequality-red.csv",stringsAsFactors=FALSE)

#numero de filas por dataset
nrow(wine_red)
ncol<-ncol(wine_red)
#sacamos 5 primeras filas
head(wine_red[,1:ncol])

sapply(wine_red,class)
```
# 1. Descripción del dataset


**Variables del dataset**


* **fixed acidity:** Conjunto de los ácidos naturales procedentes de la uva (tartárico, málico, cítrico y succínico) o formados en la fermentación maloláctica (láctico). En general, los ácidos (acidez fija) son preservante naturales del vino y ayuda a mantener el color y cualidades aromáticas. 

* **volatile acidity:** Conjunto de ácidos formados durante la fermentación o como consecuencia de alteraciones microbianas. Estos ácidos son, principalmente: ácido Acético, ácido Propionico, ácido Butírico y ácido Sulfúrico. Si la acidez volátil, presente en todos los vinos, es muy elevada el vino se picará y avigranará con el paso del tiempo. Es conveniente que la acidez volatil de un vino sea lo más baja posible.

El contenido en acidez volátil no puede ser superior a:
a) 18 miliequivalentes por litro para los mostos de uva parcialmente fermentados,
b) 18 miliequivalentes por litro para los vinos blancos y rosados,
c) 20 miliequivalentes por litro para los vinos tintos.


* **citric acid:** En pequeñas cantidades este hacido puede añadir frescor y sabor a los vinos (dentro de acido fijo)

* **residual sugar:** Azúcar que queda en el vino después de la fermentación. Es raro encontrar vinos con menos de  1 g/l y vinos con más de  45 g/l son considerados dulces
* **chlorides:** cantidad de sal en el vino
* **free sulfur dioxide :** Previene del crecimiento microbial y de la oxidación del vino.La oxidación enturbia sus colores característicos (tornándolos en amarillos intensos e, incluso, marrones).Por lo que respecta al gusto, al beberlo notaremos sabores más secos y ásperos, incluso amargos en algunos casos.

* **total sulfur dioxide:** suma de concentraciones libres y amarradas de S02; concentraciones de dioxodo de sulfuro libres superiores a  50 ppm se vuelven evidentes en el sabor y olor
* **density:** densidad del vino, suele ser similar al del agua dependiendo de la concentración de azucar y alcohol
* **pH:** Describe como de ácido o básico es el vino 0 (very acidic) to 14 (very basic); mayoria vinos en escala 3-4.(principalmente 3,55 a 4)
* **sulphates:** Actua como un antimicrobial and antioxidante. Los sulfatos de sodio y calcio aparecen en el agua y por lo tanto la uva y el vino pueden contenerlos. Un agua con una cantidad de sulfatos inferior a 250mg/l se considera en este aspecto un agua de calidad y con valores superiores a 400mg/l insalubre.

* **alcohol:** cantidad de alcohol del vino. No es muy útil para hallar la calidad
* **quality:** calidad del vino entre 0 y 10

## 1.1 ¿Por qué es importante y qué pregunta/problema pretende responder?

Pregunta: ¿Qué componente fisicoquímico influye en que un vino sea bueno?


# 2. Integración y selección de los datos de interés a analizar.

La mayoría de los atributos corresponden con características necesarias para determinar la calidad del vino. 
Sin embargo podemos prescindir del alcohol, total sulfur dioxide (indica elsuma de concentraciones libres y amarradas, solo nos interesan las libres) y density (indica proporción de alcohol y esta no es interesante para determinar la calidad).

```{r}
# Números de valores desconocidos por campo
sapply(wine_red, function(x) sum(is.na(x)))
#No se han encontrado valores vacíos o NAs. 

# Resumen de las variables
summary(wine_red)
#ph: correcto (entre 2 y 4)

```

```{r}
# Para cada una de las variables observemos si existen valores atípicos

boxplot(wine_red$fixed.acidity,main = "dixed.acidity",col="gray")
boxplot.stats(wine_red$fixed.acidity)$out

boxplot(wine_red$volatile.acidity,main = "volatile",col="gray")
boxplot.stats(wine_red$volatile.acidity)$out

boxplot(wine_red$citric.acid,main = "citric.acid",col="gray")
boxplot.stats(wine_red$citric.acid)$out

boxplot(wine_red$residual.sugar,main = "residual.sugar",col="gray")
boxplot.stats(wine_red$residual.sugar)$out

boxplot(wine_red$chlorides,main = "chlorides",col="gray")
boxplot.stats(wine_red$residual.sugar)$out

boxplot(wine_red$chlorides,main = "residual.sugar",col="gray")
boxplot.stats(wine_red$residual.sugar)$out

boxplot(wine_red$free.sulfur.dioxide,main = "free.sulfur.dioxide",col="gray")
boxplot.stats(wine_red$free.sulfur.dioxide)$out


boxplot(wine_red$pH,main = "pH",col="gray")
boxplot.stats(wine_red$pH)$out
#datos correctos porque los valores de pH estan entre 2 y 7

boxplot(wine_red$sulphates,main = "sulphates",col="gray")
boxplot.stats(wine_red$sulphates)$out

#alcohol está dentro de unos rangos adecuados
#boxplot(wine_red$ alcohol,main = " alcohol",col="gray")
#boxplot.stats(wine_red$ alcohol)$out


```
**Comprobar si sigue distribución normal**

```{r}
library(nortest)

alpha = 0.05
col.names = colnames(wine_red)
for (i in 1:ncol(wine_red)) {
  if (i == 1) cat("Variables que no siguen una distribución normal:\n")
  if (is.integer(wine_red[,i]) | is.numeric(wine_red[,i])) {
      p_val = ad.test(wine_red[,i])$p.value
        if (p_val < alpha) {
            cat(col.names[i])
                  # Format output
            if (i < ncol(wine_red) - 1) cat(", ")
            if (i %% 3 == 0) cat("\n") 
        }
      } 
  }
```
## 2.5 ¿Qué variables cuantitativas influyen más en la calidad del vino?
En primer lugar, procedemos a realizar un análisis de correlación entre las distintas variables para determinar cuáles de ellas ejercen una mayor influencia sobre la calidad del vino
```{r}
spearman_test = cor.test(wine_red[,1],wine_red[,length(wine_red)],method = "spearman")
```

```{r}
corr_matrix <- matrix(nc = 2, nr = 0)
colnames(corr_matrix) <- c("estimate", "p-value")
# Calcular el coeficiente de correlación para cada variable cuantitativa # con respecto al campo "precio"
for (i in 1:(ncol(wine_red) - 1)) {
if (is.integer(wine_red[,i]) | is.numeric(wine_red[,i]))
    { 
    spearman_test = cor.test(wine_red[,i],wine_red[,length(wine_red)],method = "spearman")
      corr_coef = spearman_test$estimate
      p_val = spearman_test$p.value
      # Add row to matrix
    pair = matrix(ncol = 2, nrow = 1)
    pair[1][1] = corr_coef
    pair[2][1] = p_val
    corr_matrix <- rbind(corr_matrix, pair)
    rownames(corr_matrix)[nrow(corr_matrix)] <- colnames(wine_red)[i]
  } 
}

a <- corr_matrix[,'estimate']
corr_matrix[order(a),]
```
Así, identificamos cuáles son las variables más correlacionadas con la calidad según su proximidad con los valores -1 y +1.
Teniendo esto en cuenta, queda patente cómo la variable más relevante en para la calidad es la variable alcohol.

Nota. Para cada coeficiente de correlación se muestra también su p-valor asociado, puesto que éste puede dar información acerca del peso estadístico de la correlación obtenida.
